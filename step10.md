# Step 10: 懒加载功能实现

## 功能概述

第十步实现了 Tree 组件的懒加载（Lazy Loading）功能，允许树节点按需动态加载子数据，而不是一次性加载全部数据。这对于处理大型数据集或需要异步获取数据的场景非常有用。

## 主要功能特性

### 1. 懒加载模式
- **按需加载**: 只有在节点展开时才加载子数据
- **异步支持**: 支持异步数据获取（如 API 调用）
- **加载状态**: 数据加载过程中显示加载动画
- **性能优化**: 避免初始化时加载大量数据

### 2. 叶子节点识别
- **自动识别**: 根据是否有子数据自动判断叶子节点
- **用户定义**: 支持通过 `isLeaf` 属性手动指定叶子节点
- **动态更新**: 加载完数据后自动更新叶子状态

### 3. 复选框联动
- **懒加载兼容**: 在懒加载模式下正确处理复选框联动
- **默认选中**: 支持设置默认选中的懒加载节点
- **状态同步**: 数据加载完成后自动同步选中状态

### 4. 状态管理
- **加载状态**: 跟踪每个节点的 `loading` 和 `loaded` 状态
- **默认展开**: 支持懒加载节点的默认展开设置
- **数据缓存**: 已加载的数据会被缓存，避免重复请求

## 使用方式

### 基础用法
```javascript
// 在 Tree 组件上启用懒加载
<el-tree
  :data="treeData"
  lazy
  :load="loadNode"
  node-key="id"
/>

// 实现 load 函数
loadNode(node, resolve) {
  // 模拟异步获取数据
  setTimeout(() => {
    const children = [
      { id: Date.now(), label: '动态节点 1' },
      { id: Date.now() + 1, label: '动态节点 2' }
    ];
    resolve(children);
  }, 1000);
}
```

### 配合复选框使用
```javascript
<el-tree
  :data="treeData"
  lazy
  :load="loadNode"
  node-key="id"
  show-checkbox
  :default-checked-keys="[11, 22]"
/>
```

### 叶子节点定义
```javascript
// 数据中包含 isLeaf 标识
const treeData = [
  { id: 1, label: '父节点' },
  { id: 2, label: '叶子节点', isLeaf: true }
];

// props 配置
const props = {
  children: 'children',
  label: 'label',
  isLeaf: 'isLeaf'
};
```

## 技术实现要点

### 1. 节点状态扩展
- 新增 `loaded` 和 `loading` 属性跟踪加载状态
- 实现 `shouldLoadData()` 方法判断是否需要懒加载
- 实现 `loadData()` 方法处理异步数据加载

### 2. 加载时机控制
- 节点展开时触发懒加载
- 复选框操作时可能触发懒加载
- 程序化展开节点时触发懒加载

### 3. 视觉反馈
- 加载过程中显示旋转的加载图标
- 支持自定义加载图标样式
- 加载完成后自动隐藏加载状态

### 4. 数据同步
- 加载完成后自动创建子节点
- 处理默认选中和展开状态
- 更新节点的叶子状态

## 配置选项

| 属性名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `lazy` | Boolean | false | 是否启用懒加载模式 |
| `load` | Function | - | 加载子节点数据的方法 |
| `props.isLeaf` | String/Function | - | 指定叶子节点的字段名或判断方法 |

## 应用场景

### 1. 大数据量树结构
- 组织架构树（员工数量庞大）
- 文件目录树（深层嵌套结构）
- 分类管理树（类目繁多）

### 2. 远程数据获取
- 需要通过 API 获取子节点数据
- 数据库分页查询场景
- 第三方服务数据集成

### 3. 性能敏感应用
- 移动端应用（减少初始加载时间）
- 低性能设备适配
- 网络环境较差的场景

## 注意事项

1. **load 函数必须性**: 启用 `lazy` 时必须提供 `load` 函数
2. **节点标识**: 懒加载模式下建议设置 `node-key` 以便正确追踪节点
3. **异常处理**: 在 load 函数中处理加载失败的情况
4. **数据结构**: 确保 resolve 回调传入的是数组格式的子节点数据

这一步的实现为 Tree 组件提供了强大的动态数据加载能力，使其能够胜任更复杂的业务场景。
