# Element Tree ç»„ä»¶å¤åˆ»é¡¹ç›®

## ğŸ“Š ä»£ç å·®å¼‚åˆ†æ

æœ¬é¡¹ç›®å½“å‰åˆ†æ”¯ç›¸å¯¹äº `feature/tree-step2-node-model` åˆ†æ”¯åœ¨ `src/tree/src` æ–‡ä»¶å¤¹ä¸‹æ–°å¢äº†é‡è¦åŠŸèƒ½ã€‚ä¸»è¦å˜åŒ–é›†ä¸­åœ¨ `tree-store.js` æ–‡ä»¶ä¸­ï¼Œæ–°å¢äº†**8 ä¸ªæ ¸å¿ƒæ–¹æ³•**ï¼Œä¸ºæ ‘ç»„ä»¶æä¾›äº†å®Œæ•´çš„æ•°æ®æ“ä½œèƒ½åŠ›ã€‚

## ğŸ¯ æ•´ä½“å®ç°æ€è·¯

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

å½“å‰åˆ†æ”¯çš„æ”¹è¿›éµå¾ªäº†ä¸€ä¸ªéå¸¸æ¸…æ™°çš„è®¾è®¡æ€è·¯ï¼š**å°† TreeStore ä»ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹ç®¡ç†å™¨å‡çº§ä¸ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ ‘æ•°æ®æ“ä½œä¸­å¿ƒ**ã€‚

è¿™ä¸ªè®¾è®¡æœ‰ä¸‰ä¸ªå…³é”®ç‰¹ç‚¹ï¼š

1. **ç»Ÿä¸€çš„æ•°æ®å…¥å£**ï¼šæ‰€æœ‰çš„æ ‘æ“ä½œéƒ½é€šè¿‡ TreeStore è¿›è¡Œï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§
2. **çµæ´»çš„èŠ‚ç‚¹å®šä½**ï¼šæ”¯æŒé€šè¿‡å¤šç§æ–¹å¼ï¼ˆèŠ‚ç‚¹å¯¹è±¡ã€key å€¼ã€æ•°æ®å¯¹è±¡ï¼‰æ¥å®šä½èŠ‚ç‚¹
3. **å®Œæ•´çš„ CRUD æ“ä½œ**ï¼šæä¾›äº†å¢åˆ æ”¹æŸ¥çš„å®Œæ•´åŠŸèƒ½é›†

### æ¶æ„è®¾è®¡äº®ç‚¹

```
TreeStore (æ•°æ®ç®¡ç†ä¸­å¿ƒ)
â”œâ”€â”€ èŠ‚ç‚¹æ˜ å°„ç®¡ç† (nodesMap)
â”œâ”€â”€ å½“å‰èŠ‚ç‚¹çŠ¶æ€ç®¡ç† (currentNode)
â””â”€â”€ æ•°æ®æ“ä½œAPI (æ–°å¢çš„8ä¸ªæ–¹æ³•)
```

## ğŸ”§ åŠŸèƒ½å®ç°è¯¦è§£

### 1. ğŸ” èŠ‚ç‚¹æŸ¥æ‰¾åŠŸèƒ½

**`getNode` æ–¹æ³•**

```javascript
getNode(data) {
  if (data instanceof Node) return data;
  const key = typeof data !== 'object' ? data : getNodeKey(this.key, data);
  return this.nodesMap[key] || null;
}
```

**è®¾è®¡å·§æ€**ï¼š

- è¿™ä¸ªæ–¹æ³•éå¸¸èªæ˜ï¼Œå®ƒèƒ½å¤„ç†ä¸‰ç§ä¸åŒç±»å‹çš„è¾“å…¥ï¼š
  - å¦‚æœä¼ å…¥çš„å·²ç»æ˜¯ Node å¯¹è±¡ï¼Œç›´æ¥è¿”å›
  - å¦‚æœä¼ å…¥çš„æ˜¯åŸºæœ¬ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ï¼‰ï¼Œå½“ä½œ key æ¥æŸ¥æ‰¾
  - å¦‚æœä¼ å…¥çš„æ˜¯æ•°æ®å¯¹è±¡ï¼Œé€šè¿‡ `getNodeKey` å·¥å…·å‡½æ•°æå– key

è¿™ç§è®¾è®¡è®©å…¶ä»–æ–¹æ³•çš„è°ƒç”¨å˜å¾—éå¸¸çµæ´»ï¼Œç”¨æˆ·å¯ä»¥ç”¨ä»»ä½•æ–¹ä¾¿çš„æ–¹å¼æ¥æŒ‡å®šèŠ‚ç‚¹ã€‚

### 2. ğŸ“ æ•°æ®æ›´æ–°åŠŸèƒ½

**`setData` æ–¹æ³•**

```javascript
setData(newVal) {
  const instanceChanged = newVal !== this.root.data;
  if (instanceChanged) {
    this.root.setData(newVal);
  }
}
```

**å®ç°è¦ç‚¹**ï¼š

- åªæœ‰å½“æ–°æ•°æ®ä¸æ ¹èŠ‚ç‚¹æ•°æ®ä¸åŒæ—¶æ‰è¿›è¡Œæ›´æ–°
- é€šè¿‡æ ¹èŠ‚ç‚¹çš„ `setData` æ–¹æ³•æ¥è§¦å‘æ•´ä¸ªæ ‘çš„æ•°æ®æ›´æ–°
- è¿™ç§è®¾è®¡é¿å…äº†ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

### 3. â• èŠ‚ç‚¹å¢åŠ åŠŸèƒ½

#### **`append` æ–¹æ³• - è¿½åŠ å­èŠ‚ç‚¹**

```javascript
append(data, parentData) {
  const parentNode = parentData ? this.getNode(parentData) : this.root;
  if (parentNode) {
    parentNode.insertChild({ data });
  }
}
```

**è®¾è®¡äº®ç‚¹**ï¼š

- å¦‚æœä¸æŒ‡å®šçˆ¶èŠ‚ç‚¹ï¼Œé»˜è®¤æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹
- åˆ©ç”¨äº†å‰é¢çš„ `getNode` æ–¹æ³•æ¥çµæ´»å®šä½çˆ¶èŠ‚ç‚¹
- é€šè¿‡çˆ¶èŠ‚ç‚¹çš„ `insertChild` æ–¹æ³•æ¥å®ç°æ·»åŠ 

#### **`insertBefore` å’Œ `insertAfter` æ–¹æ³•**

```javascript
insertBefore(data, refData) {
  const refNode = this.getNode(refData);
  refNode.parent.insertBefore({ data }, refNode);
}

insertAfter(data, refData) {
  const refNode = this.getNode(refData);
  refNode.parent.insertAfter({ data }, refNode);
}
```

**å®ç°ç‰¹ç‚¹**ï¼š

- éƒ½æ˜¯é€šè¿‡å‚è€ƒèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ¥è¿›è¡Œæ’å…¥æ“ä½œ
- ä¿æŒäº†ä¸ DOM æ“ä½œç±»ä¼¼çš„ API è®¾è®¡ï¼Œé™ä½å­¦ä¹ æˆæœ¬

### 4. âŒ èŠ‚ç‚¹åˆ é™¤åŠŸèƒ½

**`remove` æ–¹æ³•**

```javascript
remove(data) {
  const node = this.getNode(data);

  if (node && node.parent) {
    if (node === this.currentNode) {
      this.currentNode = null;
    }
    node.parent.removeChild(node);
  }
}
```

**å®‰å…¨æ€§è€ƒè™‘**ï¼š

- æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ä¸”æœ‰çˆ¶èŠ‚ç‚¹ï¼ˆé˜²æ­¢åˆ é™¤æ ¹èŠ‚ç‚¹ï¼‰
- å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰é€‰ä¸­èŠ‚ç‚¹ï¼Œè‡ªåŠ¨æ¸…ç©ºå½“å‰èŠ‚ç‚¹çŠ¶æ€
- é€šè¿‡çˆ¶èŠ‚ç‚¹æ¥æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œä¿è¯æ ‘ç»“æ„çš„å®Œæ•´æ€§

### 5. ğŸ¯ å½“å‰èŠ‚ç‚¹ç®¡ç†åŠŸèƒ½

è¿™æ˜¯ä¸€ç»„éå¸¸é‡è¦çš„çŠ¶æ€ç®¡ç†æ–¹æ³•ï¼š

#### **`setCurrentNode` æ–¹æ³•**

```javascript
setCurrentNode(currentNode) {
  const prevCurrentNode = this.currentNode;
  if (prevCurrentNode) {
    prevCurrentNode.isCurrent = false;
  }
  this.currentNode = currentNode;
  this.currentNode.isCurrent = true;
}
```

**çŠ¶æ€ç®¡ç†é€»è¾‘**ï¼š

- å…ˆæ¸…é™¤ä¹‹å‰èŠ‚ç‚¹çš„é€‰ä¸­çŠ¶æ€
- å†è®¾ç½®æ–°èŠ‚ç‚¹ä¸ºé€‰ä¸­çŠ¶æ€
- ç¡®ä¿ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å¤„äºé€‰ä¸­çŠ¶æ€

#### **`getCurrentNode` å’Œ `setCurrentNodeKey` æ–¹æ³•**

```javascript
getCurrentNode() {
  return this.currentNode;
}

setCurrentNodeKey(key) {
  if (key === null || key === undefined) {
    this.currentNode && (this.currentNode.isCurrent = false);
    this.currentNode = null;
    return;
  }
  const node = this.getNode(key);
  if (node) {
    this.setCurrentNode(node);
  }
}
```

**API è®¾è®¡è€ƒè™‘**ï¼š

- `getCurrentNode` æä¾›ç®€å•çš„è·å–æ¥å£
- `setCurrentNodeKey` æ”¯æŒé€šè¿‡ key æ¥è®¾ç½®å½“å‰èŠ‚ç‚¹ï¼Œæ›´åŠ çµæ´»
- æ”¯æŒä¼ å…¥ null/undefined æ¥æ¸…ç©ºå½“å‰èŠ‚ç‚¹

## ğŸŒŸ è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ

### 1. **é—¨é¢æ¨¡å¼ (Facade Pattern)**

TreeStore ä½œä¸ºä¸€ä¸ªé—¨é¢ï¼Œéšè—äº†åº•å±‚ Node å¯¹è±¡çš„å¤æ‚æ“ä½œï¼Œæä¾›äº†ç®€æ´ç»Ÿä¸€çš„ APIã€‚

### 2. **ç­–ç•¥æ¨¡å¼çš„ä½“ç°**

`getNode` æ–¹æ³•èƒ½å¤Ÿå¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥ï¼Œä½“ç°äº†ç­–ç•¥æ¨¡å¼çš„æ€æƒ³ã€‚

### 3. **çŠ¶æ€ç®¡ç†çš„æœ€ä½³å®è·µ**

- é›†ä¸­ç®¡ç†å½“å‰èŠ‚ç‚¹çŠ¶æ€
- ç¡®ä¿çŠ¶æ€å˜æ›´çš„åŸå­æ€§
- æä¾›å¤šç§çŠ¶æ€æ“ä½œæ–¹å¼

### 4. **é˜²å¾¡æ€§ç¼–ç¨‹**

- åœ¨æ¯ä¸ªæ–¹æ³•ä¸­éƒ½è¿›è¡Œäº†å¿…è¦çš„å‚æ•°æ£€æŸ¥
- é¿å…äº†å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒçš„è¾¹ç•Œæƒ…å†µ

## ğŸ¯ æ–°å¢æ–¹æ³•æ€»è§ˆ

è¿™æ¬¡çš„ä»£ç æ›´æ–°å°† TreeStore ä»ä¸€ä¸ªåŸºç¡€çš„èŠ‚ç‚¹æ³¨å†Œå™¨å‡çº§ä¸ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ ‘æ•°æ®ç®¡ç†ä¸­å¿ƒã€‚æ–°å¢çš„ 8 ä¸ªæ–¹æ³•è¦†ç›–äº†æ ‘æ“ä½œçš„æ‰€æœ‰æ ¸å¿ƒåœºæ™¯ï¼š

| æ–¹æ³•å              | åŠŸèƒ½åˆ†ç±» | ä¸»è¦ä½œç”¨                 |
| ------------------- | -------- | ------------------------ |
| `getNode`           | æŸ¥æ‰¾     | é€šè¿‡å¤šç§æ–¹å¼çµæ´»å®šä½èŠ‚ç‚¹ |
| `setData`           | æ›´æ–°     | æ›´æ–°æ•´ä¸ªæ ‘çš„æ•°æ®         |
| `append`            | å¢åŠ      | è¿½åŠ å­èŠ‚ç‚¹åˆ°æŒ‡å®šçˆ¶èŠ‚ç‚¹   |
| `insertBefore`      | å¢åŠ      | åœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ’å…¥æ–°èŠ‚ç‚¹   |
| `insertAfter`       | å¢åŠ      | åœ¨æŒ‡å®šèŠ‚ç‚¹åæ’å…¥æ–°èŠ‚ç‚¹   |
| `remove`            | åˆ é™¤     | å®‰å…¨åˆ é™¤æŒ‡å®šèŠ‚ç‚¹         |
| `setCurrentNode`    | çŠ¶æ€ç®¡ç† | è®¾ç½®å½“å‰é€‰ä¸­èŠ‚ç‚¹         |
| `getCurrentNode`    | çŠ¶æ€ç®¡ç† | è·å–å½“å‰é€‰ä¸­èŠ‚ç‚¹         |
| `setCurrentNodeKey` | çŠ¶æ€ç®¡ç† | é€šè¿‡ key è®¾ç½®å½“å‰èŠ‚ç‚¹    |

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/tree/src/
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ node.js          # èŠ‚ç‚¹ç±»å®šä¹‰
â”‚   â”œâ”€â”€ tree-store.js    # æ ‘æ•°æ®ç®¡ç†ä¸­å¿ƒï¼ˆæœ¬æ¬¡é‡ç‚¹æ›´æ–°ï¼‰
â”‚   â””â”€â”€ util.js          # å·¥å…·å‡½æ•°
â”œâ”€â”€ tree-node.vue       # æ ‘èŠ‚ç‚¹ç»„ä»¶
â””â”€â”€ tree.vue            # æ ‘ç»„ä»¶ä¸»æ–‡ä»¶
```

## ğŸš€ æ€»ç»“

è¿™ç§è®¾è®¡ä¸ä»…æä¾›äº†å®Œæ•´çš„åŠŸèƒ½ï¼Œè¿˜ä¿æŒäº† API çš„ç®€æ´æ€§å’Œä¸€è‡´æ€§ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„æ•°æ®ç®¡ç†å±‚å®ç°ã€‚é€šè¿‡è¿™ 8 ä¸ªæ–¹æ³•çš„æ·»åŠ ï¼ŒTreeStore ç°åœ¨å…·å¤‡äº†ï¼š

- âœ… å®Œæ•´çš„ CRUD æ“ä½œèƒ½åŠ›
- âœ… çµæ´»çš„èŠ‚ç‚¹å®šä½æœºåˆ¶
- âœ… å®‰å…¨çš„çŠ¶æ€ç®¡ç†
- âœ… ä¼˜é›…çš„ API è®¾è®¡
- âœ… è‰¯å¥½çš„æ‰©å±•æ€§

è¿™ä¸ºåç»­çš„ UI ç»„ä»¶å¼€å‘å¥ å®šäº†åšå®çš„æ•°æ®å±‚åŸºç¡€ã€‚
